<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Lalatina</title>

<style>
body {
  margin: 0;
  font-family: Arial, sans-serif;
  background: #0f172a;
  color: #fff;
}

.screen {
  display: none;
  padding: 20px;
}

.screen.active {
  display: block;
}

h1, h2 {
  text-align: center;
}

button {
  width: 100%;
  padding: 16px;
  margin-top: 14px;
  font-size: 18px;
  border: none;
  border-radius: 12px;
  background: #2563eb;
  color: #fff;
}

button.secondary {
  background: #475569;
}

button.success {
  background: #16a34a;
}

button.danger {
  background: #dc2626;
}

input {
  width: 100%;
  padding: 16px;
  font-size: 18px;
  border-radius: 12px;
  border: none;
  margin-top: 14px;
}

.feedback {
  margin-top: 14px;
  text-align: center;
  font-size: 16px;
}

.hidden {
  display: none;
}

.green { color: #22c55e; }
.red { color: #ef4444; }
</style>
</head>

<body>

<!-- HOME -->
<div class="screen active" id="home">
  <h1>Lalatina</h1>
  <p style="text-align:center">Aprenda ouvindo primeiro.</p>
  <button onclick="start()">ComeÃ§ar</button>
</div>

<!-- FASE 1 -->
<div class="screen" id="phase1">
  <h2>Fase 1</h2>

  <div id="questionText" class="hidden"></div>

  <button onclick="playAudio()">ðŸ”Š Ouvir pergunta</button>

  <input id="answer" placeholder="Digite a traduÃ§Ã£o">
  <button onclick="submitAnswer()">Responder</button>

  <button id="skipBtn" class="secondary hidden" onclick="skipQuestion()">Pular</button>
  <button id="nextBtn" class="success hidden" onclick="nextQuestion()">PrÃ³xima pergunta</button>

  <div class="feedback" id="feedback"></div>
</div>

<!-- PROVA -->
<div class="screen" id="exam">
  <h2>Prova</h2>

  <div id="examQuestion"></div>
  <button onclick="playExamAudio()">ðŸ”Š Ouvir pergunta</button>

  <input id="examAnswer" placeholder="Digite a traduÃ§Ã£o">
  <button onclick="submitExam()">Responder</button>

  <div class="feedback" id="examFeedback"></div>
</div>

<!-- RESULTADO -->
<div class="screen" id="result">
  <h2 id="resultTitle"></h2>
  <p id="resultText"></p>
  <button id="continueBtn" class="success hidden" onclick="goPhase2()">Continuar</button>
</div>

<script>
// =======================
// BANCO SIMPLIFICADO (mock)
// =======================
const bank = [
  { en: "Good morning", pt: ["bom dia"], diff: 10 },
  { en: "How are you", pt: ["como vocÃª estÃ¡", "como vai vocÃª"], diff: 30 },
  { en: "I am fine", pt: ["eu estou bem"], diff: 60 },
  { en: "Where are you from", pt: ["de onde vocÃª Ã©"], diff: 80 },
  { en: "I am learning English", pt: ["eu estou aprendendo inglÃªs"], diff: 95 }
];

// =======================
// ESTADO
// =======================
let index = 0;
let attempts = 0;
let difficulty = 10;
let answered = 0;
let correctHighLevel = 0;

// =======================
// FUNÃ‡Ã•ES GERAIS
// =======================
function show(id) {
  document.querySelectorAll(".screen").forEach(s => s.classList.remove("active"));
  document.getElementById(id).classList.add("active");
}

function start() {
  show("phase1");
  loadQuestion();
}

function loadQuestion() {
  attempts = 0;
  document.getElementById("questionText").classList.add("hidden");
  document.getElementById("feedback").innerText = "";
  document.getElementById("answer").value = "";
  document.getElementById("skipBtn").classList.add("hidden");
  document.getElementById("nextBtn").classList.add("hidden");

  current = bank.find(q => q.diff >= difficulty) || bank[bank.length - 1];
}

function playAudio() {
  const u = new SpeechSynthesisUtterance(current.en);
  u.lang = "en-US";
  speechSynthesis.speak(u);
}

function submitAnswer() {
  attempts++;
  answered++;

  const input = document.getElementById("answer").value.toLowerCase();

  if (/[a-z]{3,}/.test(input) && !input.includes("Ã£") && !input.includes("Ã§")) {
    document.getElementById("feedback").innerText = "âŒ Traduza para outro idioma.";
    return;
  }

  if (current.pt.some(p => input.includes(p))) {
    document.getElementById("feedback").innerHTML = "<span class='green'>âœ” Correto</span>";
    document.getElementById("nextBtn").classList.remove("hidden");

    if (current.diff >= 95) correctHighLevel++;
    difficulty = Math.min(difficulty + 5, 100);
  } else {
    document.getElementById("feedback").innerHTML = "<span class='red'>âœ– Errado</span>";

    if (attempts >= 3) {
      document.getElementById("questionText").innerText = "Traduza: " + current.en;
      document.getElementById("questionText").classList.remove("hidden");
    }

    if (attempts >= 5) {
      document.getElementById("skipBtn").classList.remove("hidden");
    }

    difficulty = Math.max(difficulty - 3, 1);
  }

  if (answered >= 500 || correctHighLevel >= 15) {
    startExam();
  }
}

function nextQuestion() {
  loadQuestion();
}

function skipQuestion() {
  loadQuestion();
}

// =======================
// PROVA
// =======================
let examIndex = 0;
let examHits = 0;

function startExam() {
  show("exam");
  examIndex = 0;
  examHits = 0;
  loadExamQuestion();
}

function loadExamQuestion() {
  currentExam = bank.filter(q => q.diff >= 80)[examIndex % 3];
  document.getElementById("examQuestion").innerText = "";
  document.getElementById("examAnswer").value = "";
  document.getElementById("examFeedback").innerText = "";
}

function playExamAudio() {
  const u = new SpeechSynthesisUtterance(currentExam.en);
  u.lang = "en-US";
  speechSynthesis.speak(u);
}

function submitExam() {
  const input = document.getElementById("examAnswer").value.toLowerCase();

  if (currentExam.pt.some(p => input.includes(p))) {
    examHits++;
  }

  examIndex++;

  if (examIndex >= 20) {
    finishExam();
  } else {
    loadExamQuestion();
  }
}

function finishExam() {
  show("result");

  if (examHits >= 18) {
    document.getElementById("resultTitle").innerText = "Aprovado ðŸŽ‰";
    document.getElementById("resultText").innerText =
      "VocÃª passou na prova da Fase 1.";
    document.getElementById("continueBtn").classList.remove("hidden");
  } else {
    document.getElementById("resultTitle").innerText = "Reprovado";
    document.getElementById("resultText").innerText =
      "VocÃª precisa reforÃ§ar parte da fase 1.";
  }
}

// =======================
// FASE 2 (GANCHO)
// =======================
function goPhase2() {
  alert("Fase 2 serÃ¡ iniciada aqui.");
}
</script>

</body>
</html>
