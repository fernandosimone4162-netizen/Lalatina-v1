<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Lalatina – Fase 1</title>

<style>
body { margin:0; font-family:Arial; background:#0f172a; color:#fff; }
.container { max-width:420px; margin:auto; padding:20px; }
.card { background:#020617; border-radius:12px; padding:20px; }
button,input { width:100%; padding:12px; margin-top:10px; border-radius:8px; border:none; font-size:16px; }
.primary{background:#2563eb;color:#fff}
.gray{background:#334155;color:#fff}
.success{background:#16a34a;color:#fff}
.correct{color:#22c55e}
.wrong{color:#ef4444}
.hidden{display:none}
</style>
</head>

<body>
<div class="container">
<div class="card">

<h3 id="title">Fase 1</h3>
<p id="questionText" class="hidden"></p>

<input id="answerInput" placeholder="Traduza para seu idioma">

<button class="primary" onclick="submitAnswer()">Responder</button>
<button class="gray" onclick="voiceAnswer()">Responder por voz</button>
<button class="gray hidden" id="skipBtn" onclick="skipQuestion()">Pular</button>
<button class="success hidden" id="nextBtn" onclick="nextQuestion()">Próxima</button>

<p id="feedback"></p>

<button class="gray" onclick="speakQuestion()">Ouvir pergunta</button>

</div>
</div>

<script>
/* ================= BANCO FIXO DE 10.000 PERGUNTAS ================= */

const bank=[];
for(let i=1;i<=10000;i++){
  bank.push({
    id:i,
    en:`Question ${i}`,
    answer:`pergunta ${i}`,
    difficulty:Math.ceil((i/10000)*100)
  });
}

/* ================= ESTADO DO USUÁRIO ================= */

let difficulty=1;
let attempts=0;
let history=[];
let answered=0;
let examReady=false;

/* ================= FUNÇÕES ================= */

function currentQuestion(){
  return bank.find(q=>q.difficulty===difficulty && !q.used);
}

function speak(text){
  const u=new SpeechSynthesisUtterance(text);
  u.lang="en-US";
  speechSynthesis.speak(u);
}

function speakQuestion(){
  speak(currentQuestion().en);
}

function voiceAnswer(){
  const r=new webkitSpeechRecognition();
  r.lang="pt-BR";
  r.onresult=e=>{
    document.getElementById("answerInput").value=e.results[0][0].transcript;
  };
  r.start();
}

function loadQuestion(){
  attempts=0;
  document.getElementById("feedback").innerText="";
  document.getElementById("answerInput").value="";
  document.getElementById("questionText").classList.add("hidden");
  document.getElementById("nextBtn").classList.add("hidden");
  document.getElementById("skipBtn").classList.add("hidden");
  speakQuestion();
}

/* ================= ALGORITMO ADAPTATIVO ================= */

function adaptDifficulty(correct){
  history.push(correct);
  if(history.length>10)history.shift();

  const rate=history.filter(x=>x).length/history.length;

  if(correct && attempts<=2 && rate>=0.8 && difficulty<100){
    difficulty++;
  } 
  else if(!correct && (attempts>=3 || rate<=0.5) && difficulty>1){
    difficulty--;
  }
}

/* ================= RESPOSTA ================= */

function submitAnswer(){
  const q=currentQuestion();
  const input=document.getElementById("answerInput").value.toLowerCase().trim();
  attempts++;

  if(attempts>=3){
    document.getElementById("questionText").innerText=q.en;
    document.getElementById("questionText").classList.remove("hidden");
  }

  if(input===q.answer){
    q.used=true;
    document.getElementById("feedback").innerHTML="<span class='correct'>Correto</span>";
    document.getElementById("nextBtn").classList.remove("hidden");
    adaptDifficulty(true);
    answered++;

    if(answered>=500 && difficulty>=95){
      examReady=true;
      alert("Você está pronto para a prova!");
    }
  } else {
    document.getElementById("feedback").innerHTML="<span class='wrong'>Errado</span>";
    adaptDifficulty(false);
    if(attempts>=5) document.getElementById("skipBtn").classList.remove("hidden");
  }
}

function nextQuestion(){
  if(examReady){
    alert("Prova (fase 2) será carregada aqui.");
    return;
  }
  loadQuestion();
}

function skipQuestion(){
  adaptDifficulty(false);
  loadQuestion();
}

/* ================= START ================= */

loadQuestion();
</script>
</body>
</html>
