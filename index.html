<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<title>Lalatina â€” Fase 1</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<style>
body {
    margin: 0;
    font-family: Arial, sans-serif;
    height: 100vh;
    background: url("background.jpg") no-repeat center center fixed;
    background-size: cover;
    display: flex;
    justify-content: center;
    align-items: center;
    color: white;
}

.app {
    width: 100%;
    max-width: 420px;
    position: relative;
}

/* Mascote */
.mascote {
    width: 220px;
    display: block;
    margin: 0 auto -40px auto;
    z-index: 1;
    position: relative;
}

/* Card */
.card {
    background: rgba(0, 0, 0, 0.65);
    border-radius: 18px;
    padding: 20px;
    text-align: center;
    position: relative;
    z-index: 2;
}

h1 {
    margin-top: 0;
    font-size: 22px;
}

input, select {
    width: 100%;
    padding: 12px;
    margin-top: 10px;
    border-radius: 10px;
    border: none;
    font-size: 16px;
}

button {
    width: 100%;
    margin-top: 10px;
    padding: 14px;
    border-radius: 12px;
    border: none;
    background: black;
    color: white;
    font-size: 16px;
    cursor: pointer;
}

button:hover {
    opacity: 0.85;
}

.hidden {
    display: none;
}

.feedback {
    margin-top: 10px;
    font-size: 15px;
}

.question-text {
    font-size: 20px;
    margin-bottom: 8px;
    display: none;
}
</style>
</head>

<body>

<div class="app">

<img src="lalatina.png" class="mascote">

<!-- TELA IDIOMA -->
<div class="card" id="languageScreen">
    <h1>Escolha seu idioma</h1>
    <select id="userLang">
        <option value="pt-BR">PortuguÃªs</option>
        <option value="es-ES">Espanhol</option>
        <option value="it-IT">Italiano</option>
        <option value="fr-FR">FrancÃªs</option>
        <option value="en-US">InglÃªs</option>
    </select>
    <button onclick="startApp()">ComeÃ§ar</button>
</div>

<!-- JOGO -->
<div class="card hidden" id="gameScreen">
    <h1>Fase 1</h1>

    <div class="question-text" id="questionText"></div>

    <input id="answer" placeholder="Digite ou fale a traduÃ§Ã£o">

    <button onclick="playAudio()">ðŸ”Š Ouvir</button>
    <button onclick="startVoice()">ðŸŽ¤ Falar</button>
    <button onclick="submitAnswer()">Enviar / PrÃ³xima</button>

    <div class="feedback" id="feedback"></div>
</div>

</div>

<script>
let userLanguage = "pt-BR";
let difficulty = 1;
let attempts = 0;
let questionCount = 0;
let currentQuestion = "";

const totalQuestions = Math.floor(Math.random() * (300 - 150 + 1)) + 150;

/* BANCO REAL DE FRASES */
const BANK = {
    1: [
        "hello",
        "good morning",
        "good night",
        "thank you",
        "yes",
        "no"
    ],
    2: [
        "how are you",
        "i am fine",
        "what is your name",
        "nice to meet you",
        "see you later"
    ],
    3: [
        "where are you from",
        "how old are you",
        "i like this",
        "i don't understand",
        "can you help me"
    ],
    4: [
        "what are you doing",
        "i am learning english",
        "this is very good",
        "i need some help"
    ],
    5: [
        "i would like to learn more",
        "can you speak slowly",
        "i am trying my best"
    ]
};

function startApp() {
    userLanguage = document.getElementById("userLang").value;
    document.getElementById("languageScreen").classList.add("hidden");
    document.getElementById("gameScreen").classList.remove("hidden");
    nextQuestion();
}

function nextQuestion() {
    attempts = 0;
    document.getElementById("answer").value = "";
    document.getElementById("feedback").innerText = "";
    document.getElementById("questionText").style.display = "none";

    let pool = BANK[difficulty];
    currentQuestion = pool[Math.floor(Math.random() * pool.length)];
    questionCount++;

    playAudio();
}

function playAudio() {
    let speech = new SpeechSynthesisUtterance(currentQuestion);
    speech.lang = "en-US";
    speechSynthesis.speak(speech);
}

function submitAnswer() {
    attempts++;

    if (attempts >= 3) {
        document.getElementById("questionText").innerText = currentQuestion;
        document.getElementById("questionText").style.display = "block";
    }

    document.getElementById("feedback").innerText = "Resposta registrada";

    /* ADAPTAÃ‡ÃƒO */
    if (attempts === 1 && difficulty < 5) {
        difficulty++;
    }

    if (attempts >= 3 && difficulty > 1) {
        difficulty--;
    }

    if (questionCount >= totalQuestions) {
        alert("Fase concluÃ­da. A Lalatina analisou seu desempenho.");
        return;
    }

    nextQuestion();
}

function startVoice() {
    if (!('webkitSpeechRecognition' in window)) {
        alert("Voz nÃ£o suportada");
        return;
    }

    let rec = new webkitSpeechRecognition();
    rec.lang = userLanguage;
    rec.start();

    rec.onresult = e => {
        document.getElementById("answer").value =
            e.results[0][0].transcript;
    };
}
</script>

</body>
</html>
