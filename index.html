
<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<title>Lalatina â€” Fase 1</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<style>
body {
    margin: 0;
    font-family: Arial, sans-serif;
    height: 100vh;
    background: url("background.jpg") no-repeat center center fixed;
    background-size: cover;
    display: flex;
    justify-content: center;
    align-items: center;
    color: white;
}

.app {
    width: 100%;
    max-width: 420px;
    position: relative;
}

.mascote {
    width: 220px;
    display: block;
    margin: 0 auto -40px auto;
}

.card {
    background: rgba(0, 0, 0, 0.7);
    border-radius: 18px;
    padding: 20px;
    text-align: center;
}

.hidden { display: none; }

input, select, button {
    width: 100%;
    padding: 12px;
    margin-top: 10px;
    border-radius: 10px;
    border: none;
    font-size: 16px;
}

button {
    background: black;
    color: white;
    cursor: pointer;
}

.feedback { margin-top: 10px; }
.question-text { display:none; font-size:18px; }
</style>
</head>

<body>

<div class="app">
<img src="lalatina.png" class="mascote">

<div class="card" id="languageScreen">
<h2>Choose your language</h2>
<select id="userLang"></select>
<button onclick="startApp()">Start</button>
</div>

<div class="card hidden" id="gameScreen">
<h2>Phase 1</h2>
<div id="questionText" class="question-text"></div>
<input id="answer" placeholder="Translate what you hear">
<button onclick="playAudio()">ðŸ”Š Listen</button>
<button onclick="startVoice()">ðŸŽ¤ Speak</button>
<button onclick="submitAnswer()">Submit</button>
<button id="skipBtn" class="hidden" onclick="skipQuestion()">Skip</button>
<div class="feedback" id="feedback"></div>
</div>

<div class="card hidden" id="examScreen">
<h2>Final Test</h2>
<div id="examQuestion"></div>
<input id="examAnswer">
<button onclick="submitExam()">Submit</button>
<div id="examFeedback"></div>
</div>

</div>

<script>
/* GLOBALS */
let difficulty = 1;
let attempts = 0;
let questionCount = 0;
let minQuestions = 150;
let maxQuestions = 300;
let totalQuestions = Math.floor(Math.random()*(maxQuestions-minQuestions+1))+minQuestions;
let currentQuestion = "";
let errorLog = {};
let examQuestions = [];
let examIndex = 0;
let examScore = 0;
let userLanguage = "pt-BR";

/* BANK */
const BANK = {
1:["hello","good morning","good night","yes","no"],
2:["how are you","thank you","please"],
3:["what is your name","nice to meet you"],
4:["i am learning english","can you help me"],
5:["i would like to learn more","can you speak slowly"]
};

/* TRANSLATIONS (BASE) */
const TRANSLATIONS = {
"hello":["olÃ¡","oi"],
"good morning":["bom dia"],
"good night":["boa noite"],
"yes":["sim"],
"no":["nÃ£o"],
"how are you":["como vai","como vocÃª estÃ¡"],
"thank you":["obrigado","obrigada"],
"please":["por favor"]
};

/* LANGUAGE LIST */
const select = document.getElementById("userLang");
Intl.getCanonicalLocales(
navigator.languages
).forEach(l=>{
let o=document.createElement("option");
o.value=l;o.text=l;
select.appendChild(o);
});

/* GAME */
function startApp(){
userLanguage=select.value;
document.getElementById("languageScreen").classList.add("hidden");
document.getElementById("gameScreen").classList.remove("hidden");
nextQuestion();
}

function nextQuestion(){
attempts=0;
document.getElementById("skipBtn").classList.add("hidden");
document.getElementById("feedback").innerText="";
document.getElementById("questionText").style.display="none";
let pool=BANK[difficulty];
currentQuestion=pool[Math.floor(Math.random()*pool.length)];
questionCount++;
playAudio();
}

function playAudio(){
let s=new SpeechSynthesisUtterance(currentQuestion);
s.lang="en-US";
speechSynthesis.speak(s);
}

function submitAnswer(){
attempts++;
let user=document.getElementById("answer").value.toLowerCase().trim();
let correct=(TRANSLATIONS[currentQuestion]||[]).includes(user);

if(correct){
difficulty=Math.min(5,difficulty+1);
document.getElementById("feedback").innerText="Correct!";
checkProgress();
}else{
errorLog[currentQuestion]=(errorLog[currentQuestion]||0)+1;
document.getElementById("feedback").innerText="Try again";
if(attempts>=3){
document.getElementById("questionText").innerText=currentQuestion;
document.getElementById("questionText").style.display="block";
document.getElementById("skipBtn").classList.remove("hidden");
}
}
}

function skipQuestion(){
difficulty=Math.max(1,difficulty-1);
checkProgress();
}

function checkProgress(){
if(questionCount>=totalQuestions){
startExam();
}else{
nextQuestion();
}
}

/* EXAM */
function startExam(){
document.getElementById("gameScreen").classList.add("hidden");
document.getElementById("examScreen").classList.remove("hidden");
examQuestions=Object.entries(errorLog)
.sort((a,b)=>b[1]-a[1])
.slice(0,20)
.map(e=>e[0]);
showExam();
}

function showExam(){
document.getElementById("examQuestion").innerText=examQuestions[examIndex];
}

function submitExam(){
let q=examQuestions[examIndex];
let a=document.getElementById("examAnswer").value.toLowerCase().trim();
if((TRANSLATIONS[q]||[]).includes(a)) examScore++;
examIndex++;
if(examIndex>=20){
alert(examScore>=18?"PASSED":"FAILED");
}else showExam();
}
</script>
</body>
</html
