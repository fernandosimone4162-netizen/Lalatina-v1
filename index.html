<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Lalatina — Fase 1</title>

<style>
body {
    background: #0e0e10;
    color: #fff;
    font-family: Arial, sans-serif;
    padding: 20px;
}
h1 {
    text-align: center;
    color: #ff69b4;
}
.box {
    background: #1c1c1f;
    padding: 20px;
    border-radius: 10px;
    margin-bottom: 15px;
}
button {
    width: 100%;
    padding: 14px;
    border: none;
    border-radius: 8px;
    background: #ff69b4;
    font-size: 16px;
    cursor: pointer;
}
button:hover { opacity: 0.9; }
input, select {
    width: 100%;
    padding: 12px;
    border-radius: 8px;
    border: none;
    margin-top: 10px;
}
.info {
    text-align: center;
    font-size: 14px;
    opacity: 0.7;
}
.hidden { display: none; }
</style>
</head>

<body>

<h1>Lalatina — Fase 1</h1>

<!-- TELA DE IDIOMA -->
<div class="box" id="languageScreen">
    <p>Escolha o idioma em que você irá responder:</p>
    <select id="language">
        <option>Português (Brasil)</option>
        <option>English</option>
        <option>Español</option>
        <option>Italiano</option>
        <option>Deutsch</option>
        <option>Français</option>
        <option>日本語</option>
        <option>한국어</option>
        <option>中文</option>
        <option>Outro</option>
    </select>
    <button onclick="startPhase()">Iniciar Fase</button>
</div>

<!-- TELA PRINCIPAL -->
<div id="mainScreen" class="hidden">
    <div class="box" id="questionBox">Carregando...</div>
    <input id="answer" placeholder="Digite a tradução aqui">
    <button onclick="submitAnswer()">Responder</button>
    <div class="info" id="info"></div>
</div>

<script>
/* ===============================
   CONFIGURAÇÃO DA FASE
================================ */

const MIN_QUESTIONS = 200;
const MAX_QUESTIONS = 900;
const TOTAL_QUESTIONS =
    Math.floor(Math.random() * (MAX_QUESTIONS - MIN_QUESTIONS + 1)) + MIN_QUESTIONS;

/* ===============================
   BANCO DE 10.000 PERGUNTAS
================================ */

const WORDS = [];
for (let i = 1; i <= 10000; i++) {
    WORDS.push("word_" + i);
}

/* ===============================
   ESTADO DO USUÁRIO
================================ */

let currentIndex = 0;
let difficulty = 1.0; // escala contínua
let errorsInRow = 0;
let correctInRow = 0;
let history = [];
let evaluationDone = false;
let selectedQuestions = [];

/* ===============================
   INÍCIO
================================ */

function startPhase() {
    document.getElementById("languageScreen").classList.add("hidden");
    document.getElementById("mainScreen").classList.remove("hidden");

    selectedQuestions = shuffle([...WORDS]).slice(0, TOTAL_QUESTIONS);
    showQuestion();
}

/* ===============================
   ALGORITMO ADAPTATIVO
================================ */

function showQuestion() {
    if (currentIndex >= selectedQuestions.length) {
        document.getElementById("questionBox").innerText =
            "Fase concluída. Aguardando avaliação final.";
        return;
    }

    const word = selectedQuestions[currentIndex];

    document.getElementById("questionBox").innerText =
        `Translate the word: "${word}"`;

    document.getElementById("info").innerText =
        `Pergunta ${currentIndex + 1} de ${selectedQuestions.length}
         | Dificuldade: ${difficulty.toFixed(2)}`;
}

function submitAnswer() {
    const answer = document.getElementById("answer").value.trim();
    document.getElementById("answer").value = "";

    let correct = answer.length > 0; // validação simples (fase 1)

    history.push({
        question: currentIndex + 1,
        difficulty,
        correct
    });

    if (!correct) {
        errorsInRow++;
        correctInRow = 0;
    } else {
        correctInRow++;
        errorsInRow = 0;
    }

    adjustDifficulty();
    checkMandatoryEvaluation();

    currentIndex++;
    showQuestion();
}

/* ===============================
   AJUSTE DE DIFICULDADE
================================ */

function adjustDifficulty() {
    // Se errar muito, reduz
    if (errorsInRow >= 7) {
        difficulty -= 0.1;
        errorsInRow = 0;
    }

    // Se acertar bem, aumenta lentamente
    if (correctInRow >= 5) {
        difficulty += 0.02; // máx 2% a cada 5 perguntas
        correctInRow = 0;
    }

    difficulty = Math.max(0.5, Math.min(5, difficulty));
}

/* ===============================
   REGRA OBRIGATÓRIA DOS 500
================================ */

function checkMandatoryEvaluation() {
    if (currentIndex + 1 >= 500 && !evaluationDone) {
        evaluationDone = true;

        const accuracy =
            history.filter(h => h.correct).length / history.length;

        if (accuracy >= 0.7) {
            alert("Algoritmo avaliou: usuário APTO para a prova (quando existir).");
        } else {
            alert("Algoritmo avaliou: usuário ainda NÃO apto. Continuação da fase.");
        }
    }
}

/* ===============================
   UTILITÁRIOS
================================ */

function shuffle(array) {
    for (let i = array.length - 1; i > 0; i--) {
        const j = Math.floor(Math.random() * (i + 1));
        [array[i], array[j]] = [array[j], array[i]];
    }
    return array;
}
</script>

</body>
</html>
