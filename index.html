<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Lalatina â€“ Fase 1</title>

<style>
body {
  margin:0;
  font-family: Arial, sans-serif;
  background: linear-gradient(180deg,#0b1530,#020617);
  color:white;
  display:flex;
  justify-content:center;
}
.container {
  max-width:420px;
  width:100%;
  padding:16px;
}
.card {
  background:#0f1b3d;
  border-radius:18px;
  padding:20px;
}
h2 { text-align:center; }
button {
  width:100%;
  padding:14px;
  border:none;
  border-radius:14px;
  margin-top:10px;
  font-size:16px;
}
.primary { background:#2563eb; color:white; }
.secondary { background:#1e293b; color:white; }
input {
  width:100%;
  padding:14px;
  border-radius:14px;
  border:none;
  margin-top:10px;
  font-size:16px;
}
.correct { color:#22c55e; }
.wrong { color:#ef4444; }
.hidden { display:none; }
</style>
</head>

<body>
<div class="container">
  <div class="card">

    <h2 id="title">Fase 1</h2>

    <button class="primary" onclick="speakQuestion()">ðŸ”Š Ouvir pergunta</button>

    <div id="questionText" class="hidden"></div>

    <input id="answer" placeholder="Traduza para um idioma que NÃƒO seja inglÃªs">

    <button class="secondary" onclick="startVoiceAnswer()">ðŸŽ¤ Responder por voz</button>

    <button class="primary" onclick="submitAnswer()">Responder</button>

    <button id="skipBtn" class="secondary hidden" onclick="skip()">Pular</button>

    <button id="nextBtn" class="primary hidden" onclick="nextQuestion()">PrÃ³xima pergunta</button>

    <button id="continueBtn" class="primary hidden" onclick="goToPhase2()">Continuar</button>

    <p id="feedback"></p>

  </div>
</div>

<script>
/* ============================
   BANCO FASE 1 â€“ 10.000 FIXAS
============================ */
const questionBank = [];
for (let i = 1; i <= 10000; i++) {
  questionBank.push({
    id: i,
    english: `Sentence ${i}`,
    accepted: ["bom dia", "olÃ¡", "exemplo", "traduÃ§Ã£o"],
    difficulty: Math.ceil((i / 10000) * 100)
  });
}

/* ============================
   ESTADO GLOBAL
============================ */
let currentDifficulty = 1;
let attempts = 0;
let correctHigh = 0;
let currentQuestion = null;
let inExam = false;
let examIndex = 0;
let examCorrect = 0;
let examQuestions = [];

/* ============================
   SELEÃ‡ÃƒO ADAPTATIVA REAL
============================ */
function getQuestionByDifficulty(diff) {
  const pool = questionBank.filter(q =>
    q.difficulty >= diff - 5 && q.difficulty <= diff + 5
  );
  return pool[Math.floor(Math.random() * pool.length)];
}

/* ============================
   CARREGAR PERGUNTA
============================ */
function loadQuestion() {
  attempts = 0;
  document.getElementById("feedback").textContent = "";
  document.getElementById("answer").value = "";
  document.getElementById("questionText").classList.add("hidden");
  document.getElementById("skipBtn").classList.add("hidden");
  document.getElementById("nextBtn").classList.add("hidden");

  currentQuestion = getQuestionByDifficulty(currentDifficulty);
}

loadQuestion();

/* ============================
   VOZ â€“ PERGUNTA
============================ */
function speakQuestion() {
  const u = new SpeechSynthesisUtterance(currentQuestion.english);
  u.lang = "en-US";
  speechSynthesis.speak(u);
}

/* ============================
   VOZ â€“ RESPOSTA
============================ */
function startVoiceAnswer() {
  if (!('webkitSpeechRecognition' in window)) {
    alert("Seu navegador nÃ£o suporta reconhecimento de voz.");
    return;
  }

  const rec = new webkitSpeechRecognition();
  rec.lang = "pt-BR";
  rec.onresult = e => {
    document.getElementById("answer").value =
      e.results[0][0].transcript.toLowerCase();
  };
  rec.start();
}

/* ============================
   RESPOSTA
============================ */
function submitAnswer() {
  attempts++;
  const userAnswer = document.getElementById("answer").value.toLowerCase();

  if (attempts >= 3) {
    const qt = document.getElementById("questionText");
    qt.textContent = currentQuestion.english;
    qt.classList.remove("hidden");
    speakQuestion();
  }

  if (attempts >= 5) {
    document.getElementById("skipBtn").classList.remove("hidden");
  }

  if (currentQuestion.accepted.includes(userAnswer)) {
    document.getElementById("feedback").textContent = "âœ” Correto";
    document.getElementById("feedback").className = "correct";
    document.getElementById("nextBtn").classList.remove("hidden");

    if (currentQuestion.difficulty >= 95) {
      correctHigh++;
    }

    currentDifficulty = Math.min(100, currentDifficulty + 2);
  } else {
    document.getElementById("feedback").textContent = "âœ– Errado";
    document.getElementById("feedback").className = "wrong";
    currentDifficulty = Math.max(1, currentDifficulty - 1);
  }

  if (correctHigh >= 15 && !inExam) {
    startExam();
  }
}

/* ============================
   CONTROLE
============================ */
function nextQuestion() {
  loadQuestion();
}

function skip() {
  currentDifficulty = Math.max(1, currentDifficulty - 2);
  loadQuestion();
}

/* ============================
   PROVA
============================ */
function startExam() {
  inExam = true;
  examCorrect = 0;
  examIndex = 0;

  examQuestions = questionBank.filter(q =>
    q.difficulty >= 80 && q.difficulty <= 100
  ).slice(0, 20);

  alert("VocÃª foi direcionado para a prova!");
  loadExamQuestion();
}

function loadExamQuestion() {
  if (examIndex >= 20) {
    finishExam();
    return;
  }
  currentQuestion = examQuestions[examIndex];
  attempts = 0;
  document.getElementById("answer").value = "";
  document.getElementById("questionText").textContent = currentQuestion.english;
  document.getElementById("questionText").classList.remove("hidden");
}

/* ============================
   FINAL DA PROVA
============================ */
function finishExam() {
  if (examCorrect >= 18) {
    alert("ParabÃ©ns! VocÃª passou!");
    document.getElementById("continueBtn").classList.remove("hidden");
  } else {
    alert("VocÃª nÃ£o passou. Voltando para reforÃ§o.");
    currentDifficulty = Math.floor(currentDifficulty * 0.75);
    inExam = false;
    correctHigh = 0;
    loadQuestion();
  }
}

/* ============================
   FASE 2 (PRONTO PARA ENGATAR)
============================ */
function goToPhase2() {
  alert("Fase 2 serÃ¡ carregada aqui.");
}
</script>
</body>
</html>
